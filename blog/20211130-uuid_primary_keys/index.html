<!DOCTYPE html>
<html lang="en-gb">
    <head>
        
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="description" content="Website Description">
<title>
Why We Should Use Uuids for All Primary Keys - Introduction
</title>



        
        <meta property="og:title" content="Why we should use UUIDs for all primary keys - Introduction" />
<meta property="og:type" content="website" />
<meta property="og:description" content="Website Description"/>
<meta property="og:url" content="https://tjmt.uk/blog/20211130-uuid_primary_keys/"/>
<meta property="og:site_name" content="Introduction"/>




<meta property="og:image" content="https://tjmt.uk/home/profile.jpg"/>




        
<link rel="shortcut icon" href="/img/fav.ico">


        





<link rel="stylesheet" href="/css/main.min.3679995ba0ed4b91edeef430fd34cce1e8b53c123f9993c4861941eee80b46b1.css" integrity="sha256-NnmZW6DtS5Ht7vQw/TTM4ei1PBI/mZPEhhlB7ugLRrE=" crossorigin="anonymous" media="screen">





        
        
        
        
    </head>
    <body>
        <section id="top" class="section">
            
            <div class="container hero  fade-in one ">
                

<h1 class="bold-title is-1">Blog</h1>


            </div>
            
            <div class="section  fade-in two ">
                
<div class="container">
    <hr>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        
        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false" >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
        <div class="navbar-menu " id="navMenu">
            
            
            
            
            <a class="navbar-item" href="/">main</a>
            

            
            

            
                
            

            
                
            

            
            
            
            
            
            <a class="navbar-item" href="/#about">About</a>
            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="https://tjmt.uk/projects/">
                  
                  
                  Projects
                  
                  
                  </a>
                
                
            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="https://tjmt.uk/blog/">
                  
                  Back to Blog
                  
                  </a>
                
                
            
            
            
            

            
            
            <a class="navbar-item" href="/#contact">Contact</a>
            
            

            

            
            
        </div>
    </nav>
    <hr>
</div>



                
<div class="container">
    <h2 class="title is-1 top-pad strong-post-title">
        <a href="https://tjmt.uk/blog/20211130-uuid_primary_keys/">Why we should use UUIDs for all primary keys</a>
    </h2>
    <div class="post-data">
        2021-11-30 |
        3 minutes read
    </div>
    
    <div class="blog-share">
        Share this:
        
        <a class="twitter-share-button" href="https://twitter.com/intent/tweet?text=Why%20we%20should%20use%20UUIDs%20for%20all%20primary%20keys%20https%3a%2f%2ftjmt.uk%2fblog%2f20211130-uuid_primary_keys%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fab fa-twitter"></i>
            <span class="hidden">Twitter</span>
        </a>
        
        
        
    </div>
    
    
      
    
      
    
      
    
      
    
      
    
      
      
     <p>
         Tags: 
          
           <a href="/tags/sql">
             SQL</a>
         
        </p>
      
    
      
    
</div>

<div class="container markdown top-pad">
    <p>Recently I&rsquo;ve been working with <a href="https://digital.nhs.uk/data-and-information/data-tools-and-services/data-services/hospital-episode-statistics">HES</a>
data on a project, and the current structure of tables we have is for each of the different datasets (Inpatients,
Outpatients, Emeregency Care, etc.) we have a separate table for each financial year. Within these there will be a
column like <code>EPIKEY</code> or <code>ATTENDKEY</code> which is the primary key in that table. This key is stored as a <code>BIGINT</code>.</p>
<p>This key restarts counting each year&hellip; well, sort of. Sometimes the minimum value is 1, other times it&rsquo;s in the
100,000,000&rsquo;s.</p>
<p>What I wanted to do was build a single table that had all of the inpatients records (and later, do the same for the
other datasets). Because the <code>EPIKEY</code> values may repeat in different years I need someway to make these unique. One way
of achieveing this would be to create the primary key as a composite of <code>FYEAR</code> and <code>EPIKEY</code>.</p>
<p>This is what I have seen done in other databases, but (in my opinion) it&rsquo;s a very dangerous approach to take. Why?
Because it&rsquo;s far to easy to write a query that joins to other tables and forget to include all of the columns in the
composite key, for instance:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#007020;font-weight:bold">SELECT</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>stuff<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#007020;font-weight:bold">FROM</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>inpatients<span style="color:#bbb"> </span>i<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#007020;font-weight:bold">INNER</span><span style="color:#bbb"> </span><span style="color:#007020;font-weight:bold">JOIN</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>inpatients_diagnoses<span style="color:#bbb"> </span>d<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#007020;font-weight:bold">ON</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>i.EPIKEY<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>d.EPIKEY<span style="color:#bbb">
</span></code></pre></div><p>And I&rsquo;ve seen many, many, analysts fall into this trap. It&rsquo;s not always a case of simply forgetting either. Many times
people will approach a new database and start just trying to write a query without looking at a database diagram (if one
exists), or inspecting the primary/foreign key contraints on a table (and all too often I&rsquo;ve seen databases created
without these being implemented). I think this is exacerbated because we treat SQL as something that analysts must
learn, but forget to teach them any theory about databases and their structure.</p>
<p>So, what is the solution to this? What I did was rename the <code>EPIKEY</code> column to <code>ORIG_EPIKEY</code> (rather than dropping it
and finding out we needed it later), and adding a new <code>EPIKEY</code> column of type <code>UNIQUEIDENTIFIER</code>. Now I have a single
column as the primary key, so my above query works, reducing the risk of incorrect joins.</p>
<p>A <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a> (Universally Unique Identifier) is, for practical
purposes, unique. As in, it&rsquo;s unique in any system that may ever exist. This it turns out is a very useful property. If
we build our database tables to use a UUID as the primary key, we do not need it to be composite with any other columns.</p>
<p>And there is an added benefit. Consider we have two tables, <code>table_a</code> and <code>table_b</code> that both use an incrementing
integer as the primary key. We could join <code>table_a</code> and <code>table_b</code> together on their primary keys, and the database will
happily spit out results. But they may be completely useless. If however we use a UUID, then the join will only ever
return results where the keys match. If the keys were generated separately, then there is no chance of a collision
between <code>table_a</code> and <code>table_b</code>, so any query that tries to join these two will result in 0 rows of data (this would be
a good indicator to anyone that the query isn&rsquo;t correct). If, and only if, the keys were generated in one place, say
<code>table_a</code>, and then used as a foreign key in <code>table_b</code> would our query work. This is a great guarantee that our results
are correct and valid.</p>
<p>Of course, there is a downside to using this datatype. For one, it&rsquo;s slower to generate than an autoincrementing number.
I&rsquo;ve never found generating these values to be terribly slow however. The big downside is storage: a typical ID column
may be a <code>BIGINT</code> which takes up 8 bytes, whereas a UUID is 128 bytes, 16 times bigger. In certain circumstances these
two may be just enough of a difference to cause an issue.</p>

</div>





                
                <div class="container">
    <hr>
</div>
<div class="container has-text-centered top-pad">
    <a href="#top">
        <i class="fa fa-arrow-up"></i>
    </a>
</div>

<div class="container">
    <hr>
</div>

                <div class="section" id="footer">
    <div class="container has-text-centered">
    
        <span class="footer-text">
            <a href="https://github.com/victoriadrake/hugo-theme-introduction/"><strong>Introduction</strong></a> theme for <a href="http://gohugo.io/">Hugo</a>. Made with <a href="https://victoria.dev"><i class="fa fa-heart"></i> and <i class="fa fa-coffee"></i></a> by open source contributors.
        </span>
    
    </div>
</div>

                
            </div>
        </section>
        
        


<script src="https://tjmt.uk/js/bundle.f1741e9868b2f697e71cf8fccfcc12166540999b3d36f8fb9edd0882ba425d55.js" integrity="sha256-8XQemGiy9pfnHPj8z8wSFmVAmZs9Nvj7nt0IgrpCXVU="></script>






        
        
        
        
    </body>
</html>
